<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Signup</title>
        <link rel="stylesheet" href="">
        <style>
        </style>
    </head>
    <body>
        <div class="root">
            <h3 class="error-str"></h3>
            <form id="main-form">
                <p>Username <input type="text" id="username"></p>
                <p>Password <input type="text" id="password1"></p>
                <p>Password <input type="text" id="password2"></p>
                <p>
                    <input type="submit" value="Submit">
                    <input type="reset" value="Reset">
                </p>
            </form>
        </div>
        <script>
            const form = document.getElementById('main-form');
            const errorField = document.querySelector('.error-str');
            const username = document.getElementById('username');
            const password = document.getElementById('password1');
            const repassword = document.getElementById('password2');
            const successURL = 'http://127.0.0.1:8000/api/v1/user/'
            const successMeta = `<meta http-equiv="refresh" content="0; URL=${successURL}">`;
            const url = 'http://127.0.0.1:8000/api/v1/auth/users/'
            function submitForm () {
                event.preventDefault();
                if (password.value === repassword.value) {
                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json;charset=utf-8'
                        },
                        body: JSON.stringify({
                            username: username.value,
                            password: password.value,
                        })
                    }).then(res => {
                    if (res.status === 400){
                    return res.json();
                    } else {
                    document.querySelector('head').insertAdjacentHTML('beforeend', successMeta)};
                    })
                    .then(result => {
                        if (result.username) {
                            errorField.innerHTML = result.username;
                        } else if (result.password) {
                            errorField.innerHTML = result.password;
                        } else {
                            errorField.innerHTML = 'unknown error, please try again later';
                        };
                    })
                    .catch(error => console.log(error));
                } else {
                    errorField.innerHTML = 'Passwords must match';
                }
            };
            form.addEventListener('submit', submitForm);
        </script>
    </body>
</html>